@page
@model InvoiceModel
@{ }


<div class="row">
    <div class="col-md-8">
        <span class="badge bg-blue" style="width: fit-content; height: fit-content;">PAID</span>
        <label><h3>Bill</h3></label>
        <div class="row">
            <div class="col-md-10">
                @Html.TextBox("staticText", "", new { @id = "staticText", @autocomplete = "off", @class = "form-control col-md-10", placeholder = "Please find attached your invoice. Thank you for timely payment" , @readonly="True"})
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <img src="@Url.Content("~/images/bukalapakLogo.png")" alt="tbd" style="width: 170px; height: 100px" />
    </div>
</div>

<div class="row">
    <div class="col-4">
        <b>Invoice. No</b>
        <div class="col-auto">
            <div class="input-group mb-2">
                <div class="input-group-prepend">
                    <div class="input-group-text">#</div>
                </div>
                <input type="text" class="form-control" id="txtInvNo" placeholder="Invoice">
            </div>
        </div>
    </div>

    <div class="col-4">
        <b>Language</b>
        <div class="dropdown">
            @Html.DropDownList("cboLanguage", new SelectList(new[] { "" }),
                     new { @class = "btn btn-secondary dropdown-toggle form-control" })
        </div>
    </div>
    <div class="col-4">
        <b>Currency</b>
        <div class="dropdown">
            @Html.DropDownList("cboCurrency", new SelectList(new[] { "" }),
                          new { @class = "btn btn-secondary dropdown-toggle form-control" })
        </div>
    </div>
</div>

<hr />




<div class="row">
    <div class="col-4 themed-grid-col">
        <div class="col-2"><b>From</b></div>
        <div class="col-md-10">
            <textarea id="txtAddressFrom" type="search" class="form-control" style="min-width: 100%; height: 118px;"></textarea>
            <span id="searchclear" class="glyphicon glyphicon-remove-circle"></span>
        </div>
    </div>
    <div class="col-4"></div>
    <div class="col-4 themed-grid-col">
        <b>Date</b>
        <div class="form-group input-group-sm">
            <input type="text" id="txtSelectedDate" name="SelectedDate" class="form-control" />
        </div>
        <b>Invoice Due</b>
        <div class="form-group input-group-sm">
            @Html.DropDownList("cboInvoice", new SelectList(new[] { "" }),
                new { @class = "btn btn-secondary dropdown-toggle form-control" })
        </div>
    </div>
</div>

<div class="row">
    <div class="col-4 themed-grid-col">
        <div class="col-2"><b>To</b></div>
        <div class="col-md-10">
            @Html.DropDownList("cboCustomer", new SelectList(new[] { "" }),
                new { @class = "btn btn-secondary dropdown-toggle form-control" })
            @Html.Label("lblAddresTo", "",new { @id= "lblAddresTo" })
        </div>
    </div>
    <div class="col-4"></div>
    <div class="col-4 themed-grid-col">
        <b>Purchase Order Number</b>
        <div class="form-group input-group-sm">
            <input type="text" id="txtInvoicePopUP" name="invPopUp" class="form-control" />
        </div>
    </div>
</div>

<hr/>

<div class="row">
    <fieldset>
        <table id="detailTable" class="table ">

            <tr>
                <td><b>Name     </b></td>
                <td><b>Quantity </b></td>
                <td><b>Rate     </b></td>
                <td><b>Amount   </b></td>
            </tr>


            <tr id="tablerow0">
                <td>
                    <div class="editor-field">
                        <div id="editor0"></div>
                    </div>
                </td>
                <td>
                    <div class="editor-field">
                        <input class="text-box single-line" id="txtTbl_Qty[0]" type="text" value="" required="required" />
                    </div>
                </td>
                <td>
                    <div class="editor-field">
                        <input class="text-box single-line" id="txtTbl_Rate[0]" type="text" value="" required="required" />
                    </div>
                </td>
                <td>
                    <div class="editor-field">
                        <input class="text-box single-line" name="txtTbl_Amount[0]" type="text" value="" required="required" />
                    </div>
                </td>
            </tr>

        </table>

        <div class="row">
            <div class="col-8 themed-grid-col">
                <button id="add" type="button" class="btn btn-primary">Add</button>
            </div>
            <div class="col-2">Sub Total</div>
            <div class="col-2" themed-grid-col">
                <div class="form-group input-group-sm" style="text-align: right;">
                    <label id="lblsubTotal">x</label>
                </div>

            </div>
        </div>

        <div class="row">
            <div class="col-8">
            </div>
            <div class="col-4">
                <hr />
            </div>
        </div>


        <div class="row">
            <div class="col-8 themed-grid-col">

            </div>
            <div class="col-2">Sub Total</div>
            <div class="col-2" themed-grid-col">
                <div class="form-group input-group-sm" style="text-align: right;">
                    <label id="lblDiscount">y</label>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-8">
            </div>
            <div class="col-4">
                <hr />
            </div>
        </div>

        <div class="row">
            <div class="col-8 themed-grid-col">

            </div>
            <div class="col-2"><b>Total<label id="lblCurrencyInitial"></label></b></div>
            <div class="col-2" themed-grid-col">
                <div class="form-group input-group-sm" style="text-align: right;">
                    <label id="lblTotalAll">z</label>
                </div>
            </div>
        </div>


        <hr />


    </fieldset>
</div>

    <p>
        <input type="submit" value="Save" class="btn btn-primary" />
    </p>


    <link rel="stylesheet" href="~/lib/jquery-ui-1.12.1/jquery-ui.css" />

    <script src="~/lib/ckeditor5-build-classic/ckeditor.js"></script>
    <script src="~/lib/jquery/dist/jquery-3.6.0.min.js"></script>
    <script src="~/lib/jquery-ui-1.12.1/jquery-ui.js"></script>

    <script>
        ClassicEditor
            .create(document.querySelector('#editor0'))
            .catch(error => {
                console.error(error);
            });
    </script>

    <script type="text/javascript">


        //Data Load from back
        function langLoad() {

            $.ajax({
                type: "GET",
                url: "http://localhost:4000/api/language",
                data: {},
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    $("#cboLanguage").empty();
                    $.each(data, function () {
                        $("#cboLanguage").append($("<option></option>").val(this['Initial']).html(this['Description']));
                    });
                },
                failure: function (response) {
                    alert(response);
                }
            });

        }

        function currencyLoad() {
            $.ajax({
                type: "GET",
                url: "http://localhost:4000/api/currency",
                data: {},
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    $("#cboCurrency").empty();
                    $.each(data, function () {
                        $("#cboCurrency").append($("<option></option>").val(this['Initial']).html(this['Description']));
                    });
                },
                failure: function (response) {
                    alert(response);
                }
            });
        }


        function poDetailLoad() {
            $.ajax({
                type: "GET",
                url: "http://localhost:4000/api/poDetail",
                data: {},
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    //alert(JSON.stringify(data));
                    var obj = JSON.stringify(data);
                    

                    $.each(data, function () {

                        $('#cboCustomer').empty();
                        $('#cboCustomer').append($("<option></option>").val(this['-']).html(this['Name_Customer']));

                    $('#txtSelectedDate').val(this['Date'].dateFormat('yy-mm-dd'));

                       

                       

                    

                    $('#lblsubTotal').val(this['SubTotal']);
                    $('#lblDiscount').val(this['Discount']);
                    $('#lblCurrencyInitial').val(this['PO_Number']);
                    $('#lblTotalAll').val(this['Total']);

                    });
                },
                failure: function (response) {
                    alert(response);
                }
            });
        }

        function poHeaderLoad() {
            $.ajax({
                type: "GET",
                url: "http://localhost:4000/api/poHeader",
                data: {},
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    

                    var obj = JSON.stringify(data);
                    alert(obj);
                    

                    $.each(data, function () {                   

                        $('#txtInvNo').val(this['Inv_Number']);

                        alert(this['Addr_From']);
                        $('#txtAddressFrom').val(this['Addr_From']);
                        $('#lblAddresTo').text(this['Addr_To']);

                        $('#cboInvoice').empty();
                        $('#cboInvoice').append($("<option></option>").val(this['-']).html(this['InvoiceDue']));
                        //$('#cboLanguage').select(this['Inv_Number']);
                        //$('#cboCurrency').val(this['Inv_Number']);
                        
                        $('#txtInvoicePopUP').val(this['PO_Number']);
                    });
                },
                failure: function (response) {
                    alert(response);
                }
            });
        }

        //






        $(document).ready(function () {
            var numbers = [1, 2, 3, 4, 5];
            var option = '';
            for (var i = 0; i < numbers.length; i++) {
                option += '<option value="' + numbers[i] + '">' + numbers[i] + '</option>';
            }
            $('#items').append(option);


            langLoad();
            currencyLoad();
            
            poHeaderLoad();
            poDetailLoad();
        });



        $('#txtSelectedDate').datepicker({
            dateFormat: 'yy-mm-dd',
            minDate: 0
        });

        $("#txtSelectedDate").datepicker().datepicker("setDate", new Date());

        var counter = 1;

        $(function () {
            $('#add').click(function () {
                $('<tr id="tablerow' + counter + '"><td>' +
                    '<div id="editor' + counter + '"></div>' +
                    '<script>' +
                    ' ClassicEditor ' +
                    ' .create(document.querySelector(' + '\'#editor' + counter + '\')) ' +
                    ' .catch(error => { ' +
                    ' console.error(error); ' +
                    ' }); ' +
                    ' </\script> ' +
                    '</td>' +
                    '<td>' +
                    '<input type="text" class="text-box single-line" id="txtTbl_Qty[' + counter + ']" value="" required="required" />' +
                    '</td>' +
                    '<td>' +
                    '<input type="text" class="text-box single-line" id="txtTbl_Rate[' + counter + ']" value="" required="required" />' +
                    '</td>' +
                    '<td>' +
                    '<input type="text" class="text-box single-line" id="txtTbl_Amount[' + counter + ']" value="" required="required" />' +
                    '</td>' +
                    '<td>' +
                    '<button type="button" class="btn btn-primary" onclick="removeTr(' + counter + ');">Delete</button>' +
                    '</td>' +
                    '</tr>').appendTo('#detailTable');
                counter++;
                return false;
            });





        });

        function removeTr(index) {
            if (counter > 1) {
                $('#tablerow' + index).remove();
                counter--;
            }
            return false;
        }

        $("#searchclear").click(function () {
            $("#searchinput").val('');
        });


    </script>
